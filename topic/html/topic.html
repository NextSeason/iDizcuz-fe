<!DOCTYPE html>
<html>
    <head>
        <?php 
            $type_arr = array( '讨论', '辩论' );
            $title = $type_arr[ $topic[ 'type' ] ] . '：' . $topic[ 'title' ] . '- 每日论点 • iDizcuz';
        ?>
        @Include::common::head.inc.html
        <link rel="stylesheet" href="@Static::css/topic.css" />
        <link rel="stylesheet" href="@Static::common::css/umeditor/default/css/umeditor.css" />
    </head>
    <body>
        <div id="idizcuz" 
            data-account-id="<?php echo isset( $account['id'] ) ? $account['id'] : 0; ?>" 
            data-account-uname="<?php echo isset( $account['uname'] ) ? htmlspecialchars( $account['uname'] ) : ''; ?>"
        >
            @Include::common::top.inc.html
            <div class="boxes main">
                <div class="inner clearfix">
                    <div class="topic-area l" data-topic-id="<?php echo $topic[ 'id' ]; ?>">
                        <div class="title-line">
                            <h1><?php echo $type_arr[ $topic[ 'type' ] ]; ?>：<?php echo $topic[ 'title' ]; ?></h1>
                            <p>
                                <a href="/topic/page/list" target="_blank" class="btns small dark r">更多论点</a>
                                <span>发布日期：2015-09-09</span>
                            </p>
                        </div>
                        <div class="desc">
                            <p><?php echo $topic[ 'desc' ]; ?></p>
                        </div>
                        <?php if( strlen( $topic[ 'events' ] ) > 0 ) { ?>
                            <div class="show-events" data-events-ids="<?php echo $topic['events']; ?>">
                                点击查看此论点相关内容和信息
                            </div>
                        <?php } ?>
                        <div class="events">
                            <div class="loading"></div>
                        </div>
                        <div class="list-area">
                            <div class="operate-line clearfix">
                                <span class="count">本论点共 <i><?php echo $topic['data']['post_cnt']; ?></i> 条讨论</span>
                                <ul class="r clearfix">
                                    <li><a href="###" class="focus sort" data-order-type="0">最新讨论</a></li>
                                    <li><a href="###" class="sort" data-order="1">最多支持</a></li>
                                    <li><a href="###" class="sort" data-order="2" >最多反对</a></li>
                                </ul>  
                            </div>
                            <div class="loading list-top"></div>
                            <ul class="post-list"></ul>
                        </div>
                        <div id="editor-inflow-box">
                            <div id="editor-area" class="editor-area">
                                <?php if( $account ) { ?>
                                    <div class="line clearfix">
                                        <span>论述标题：</span>
                                        <input type="text" class="long title" placeholder="如果标题为空，系统则自动获取部分论述内容作为标题" />
                                        <a href="###" class="get-title">从内容中获取标题</a>
                                    </div>
                                    <div id="textbox" class="textbox">
                                        <script type="text/plain" id="editor" class="editor">
                                            <p>在此输入您想发表的内容</p>
                                        </script>
                                    </div>
                                    <div class="line clearfix to-line">
                                        <span>针对论述：</span>
                                        <a href="###" class="to-title" target="_blank"></a>
                                        <input type="hidden" class="to" />
                                        <a href="###" class="remove-to"><i class="fa fa-times-circle"></i></a>
                                    </div>
                                    <div class="submit-line clearfix">
                                        <p class="post-tip"></p>
                                        <p class="post-warn"></p>
                                        <a href="###" class="btns large public">发布观点</a>
                                    </div>
                                <?php } else { ?>
                                    <div id="textbox" class="textbox">
                                        <div class="not-login-editor">
                                            <p>请登录并发表您的观点
                                                <a href="/signin">登录</a>
                                                /
                                                <a href="/signup">注册</a>
                                            </p>
                                        </div>
                                    </div>
                                <?php } ?>
                            </div>
                        </div>
                    </div>
                    <div class="sidebar r">
                        <?php if( $account ) { ?>
                            <div class="new-post">
                                <p>心理所想，不吐不快</p>
                                <a href="###" class="btns large">分享我的观点</a>
                            </div>
                        <?php } else { ?>
                            <div class="about-idizcuz">
                                <p>试着去成为一个理性且有思想的人<p>
                                <a href="/account/page/signup" class="btns large">加入每日论点 • iDizcuz</a>
                            </div>
                        <?php } ?>
                    </div>
                </div>
            </div>
            <div class="footer boxes">
                <div class="inner">
                </div>
            </div>
            <div id="complain-box" data-target-id="0">
                <form>
                    <input type="hidden" class="comment_id" />
                    <?php foreach( $reportReasons as $key => $value ) { ?>
                        <label>
                            <input type="radio" name="reasons-<%=data[i].id %>" value="<?php echo $key; ?>" />
                            <span class="msg"><?php echo $value; ?></span>
                        </label>
                    <?php } ?>
                    <textarea placeholder="简述您的举报理由"></textarea>
                    <div class="op-line">
                        <a href="###" class="cancel">取消</a>
                        <a href="###" class="btns">提交</a>
                    </div>
                </form>
            </div>
            <a href="javascript:void(0)" id="copy-btn" class="btns">复制链接</a>
            <div id="remove-post-dialog" class="dialogs" >
                <div class="inner">
                    <input type="hidden" class="post-id" />
                    <div class="text">
                        <p>您确定要删除这条论述么？</p>
                        <p class="fail"><i class="brand fa fa-warning"></i> 操作失败，请稍候再试</p>
                        <p class="tip"><i class="brand fa fa-lightbulb-o"></i> 删除该论述将会扣掉您 <b class="brand">100积分</b></p>
                    </div>
                    <div class="ft">
                        <a href="###" class="btns confirm">确定</a>
                        <a href="###" class="btns dark cancel">取消</a>
                    </div>
                </div>
            </div>
            <div id="editor-dialog" class="dialogs">
                <div class="inner">
                    <a href="###" class="minus"><i class="fa fa-times"></i></a>
                    <div id="editor-float-box"></div>
                </div>
            </div>
        </div>
        <!-- templates area start -->
        <textarea class="templates" id="events-list-tpl">
            <div class="nav-list">
                <a href="###" class="scroll scroll-right r" data-direction="right">
                    <i class="fa fa-chevron-right"></i>
                </a>
                <a href="###" class="scroll scroll-left l" data-direction="left">
                    <i class="fa fa-chevron-left"></i>
                </a>
                <div class="list-box">
                    <% var l = data.length %>
                    <ul class="clearfix" style="width:<%= l * 135 + 6 * ( l - 1 ) %>">
                        <% for( var i = 0; i < l; i++ ) { %>
                            <li>
                                <a href="###" title="" class="events-nav" data-event-id="<%=data[i].id %>">
                                    <img src="http://topicstc.idizcuzz.com/<%=data[i].img%>" />
                                </a>
                            </li>
                        <% } %>
                    </ul>
                </div>
            </div>
            <div class="bubbles events-tip">
                <div class="triangle"><div class="triangle"></div></div>
                <div class="inner">
                    <p class="text"></p>
                </div>
            </div>
        </textarea>
        <textarea class="templates" id="event-content-tpl">
            <div class="event-content">
                <h4 class="title"><%=data.title %></h4>
                <div class="clearfix">
                    <span class="origin">内容来自：<a href="<%=data.origin_url %>"><%=data.origin %></a></span>
                    <span class="author">作者：<%=data.author %></span>
                    <span class="date">时间：<%=data.time %></span>
                </div>
                <div class="event-text"><%=data.content %></div>
                <div class="event-info">
                </div>
            </div>
        </textarea>
        <textarea class="templates" id="post-list-tpl">
            <% if( !data.length ) { %>
                <div class="empty">此论点目前还没有论述，快发布您的论述，并分享给您的好友吧</div>
            <% } else { %>
                <% for( var i = 0, l = data.length; i < l; i += 1 ) { %>
                    <% if( data[i].hide ) { continue } %>
                    <li class="posts" id="post-<%=data[i].id %>" data-post-id="<%=data[i].id %>">
                        <div class="data-line clearfix">
                            <div class="operates r">
                                <% if( !data[i].isMine ) { %>
                                    <% var mark = +data[i].mark %>
                                    <a href="###" class="op-btn op-<% if( mark ) { %>unmark<% } else { %>mark<% } %>" data-action="mark" data-mark-id="<%=mark %>">
                                        <% if ( mark ) { %>
                                            <i class="fa fa-star"></i> 取消收藏
                                        <% } else { %>
                                            <i class="fa fa-star-o"></i> 收藏
                                        <% } %>
                                    </a>
                                <% } %>
                                <a href="###" class="op-btn" data-action="share">分享</a>
                                <% if( !data[i].isMine ) { %>
                                    <a href="###" class="op-btn" data-action="report">举报</a>
                                <% } %>
                            </div>
                            <div class="vote l">
                                <a href="###" class="op-btn btns small agree" data-action="agree" data-intent="1">支持(<b><%=data[i].data.agree %></b>)</a>
                                <a href="###" class="op-btn btns small disagree" data-action="agree" data-intent="0">反对(<b><%=data[i].data.disagree %></b>)</a>
                            </div>
                            <div class="title l">
                                <h2><a href="/topic?topic=<?php echo $topic['id']; ?>&post=<%=data[i].id %>" target="_blank"><%=data[i].title %></a></h2>
                                <a href="/user?u=<%=data[i].account.id %>" class="uname" target="_blank">作者： <%=data[i].account.uname %><%=data[i].account.desc %></a>
                            </div>
                        </div>
                        <div class="bubbles op-bubbles">
                            <a href="###" class="close"><i class="fa fa-times"></i></a>
                            <div class="triangle"><div class="triangle"></div></div>
                            <div class="inner">
                                <div class="mark box clearfix">
                                    <p class="l">收藏成功！您可以在<a href="/user/mark">我的主页</a>中查看。您也可以分享这条论述，让更多人参与讨论</p>
                                    <div class="share-box l">
                                        <a class="share-btns" data-dest="qzone"><i class="fa fa-qq"></i></a>
                                        <a class="share-btns" data-dest="weibo"><i class="fa fa-weibo"></i></a>
                                        <a class="share-btns" data-dest="renren"><i class="fa fa-renren"></i></a>
                                        <a class="share-btns" data-dest="tx_weibo"><i class="fa fa-tencent-weibo"></i></a>
                                        <a class="share-btns" data-dest="facebook"><i class="fa fa-facebook-official"></i></a>
                                        <a class="share-btns" data-dest="twitter"><i class="fa fa-twitter"></i></a>
                                    </div>
                                </div>
                                <div class="share box clearfix">
                                    <div class="qrcode l"></div>
                                    <div class="share-part l">
                                        <div class="bdsharebuttonbox share-btn-boxes share-box" data-tag="share_1">
                                            <a class="share-btns" data-dest="qzone"><i class="fa fa-qq"></i></a>
                                            <a class="share-btns" data-dest="weibo"><i class="fa fa-weibo"></i></a>
                                            <a class="share-btns" data-dest="renren"><i class="fa fa-renren"></i></a>
                                            <a class="share-btns" data-dest="tx_weibo"><i class="fa fa-tencent-weibo"></i></a>
                                            <a class="share-btns" data-dest="facebook"><i class="fa fa-facebook-official"></i></a>
                                            <a class="share-btns" data-dest="twitter"><i class="fa fa-twitter"></i></a>
                                        </div> 
                                        <div class="share-link">
                                            <div class="line clearfix">
                                                <span class="l">分享此条论述：</span>
                                                <a href="http://www.idizcuz.com/topic?id=<%=data[i].topic_id%>&post=<%=data[i].id %>&fr=sharelink" data-title="<%-data[i].title %>" target="_blank" class="share-post-link link l">http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>post=<%=data[i].id %>&fr=sharelink</a>
                                                <a href="###" class="btns l copy-link">复制链接</a>
                                            </div>
                                            <div class="line clearfix">
                                                <span class="l">分享当前论点：</span>
                                                <a href="http://www.idizcuz.com/topic?id=<%=data[i].topic_id %>&fr=sharelink" data-title="<?php echo $topic['title']; ?>>" target="_blank" class="share-topic-link link l">http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>&fr=sharelink</a>
                                                <a href="###" class="btns l copy-link">复制链接</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="report box clearfix">
                                    <div class="reasons l">
                                        <?php foreach( $reportReasons as $key => $value ) { ?>
                                            <label>
                                                <input type="radio" name="reasons-<%=data[i].id %>" value="<?php echo $key; ?>" />
                                                <span class="msg"><?php echo $value; ?></span>
                                            </label>
                                        <?php } ?>
                                    </div>
                                    <div class="l desc-area">
                                        <textarea class="desc" placeholder="请对您举报的内容做简单描述，长度不可超过250字">&lt;/textarea>
                                        <p class="brand alert">*  核实举报后此论述会被删除，作者将受到相关惩罚。恶意举报也将面对相关策略惩罚</p>
                                        <div class="btn-line">
                                            <span class="tip"></span>
                                            <a href="###" class="btns report-submit">提交举报</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="contents rich-text">
                            <p><%=data[i].content %></p>
                        </div>
                        <% if( data[i].to != 0 ) { %>
                            <div class="to-area">
                                <span><i class="fa fa-hand-o-right"></i> 所针对论述：</span>
                                <a href="/topic?post=<%=data[i].to.id %>" target="_blank"><%=data[i].to.title %></a>
                            </div>
                        <% } %>
                        <div class="bottom-line">
                            <a href="#editor" class="reply-to r">针对本条论述发表观点</a>
                            <span class="ctime">发表于：<%=data[i].ctime %></span>
                            <% if( data[i].mtime != data[i].ctime ) { %>
                                <span class="mtime">修改于：<%=data[i].mtime %></span>
                            <% } %>
                            <a href="###" class="comments"><%=data[i].data.comments_cnt %>条短评</a>
                            <% if( data[i].isMine ) { %>
                                <a href="###" class="remove-post" title="删除后论述可以在个人中心找到，可在个人中心恢复发布或彻底删除"><i class="fa fa-trash"></i> 删除</a>
                            <% } %>
                        </div>
                        <div class="comments-box">
                            <div class="loading"></div>
                            <ul class="comments-list"></ul>
                            <form class="comments-form clearfix">
                                <input type="text" class="comment l" placeholder="输入评论内容" />
                                <a href="###" class="btns submit l">评论</a>
                            </form>
                        </div>
                    </li>
                <% } %>
            <% } %>
        </textarea>
        <textarea class="templates" id="target-post-tpl">
            <div class="target-post">
                <div class="post-detail"></div>
                <div class="bridge">
                    以下为此论述所在的『论点』内容
                    <a href="/topic?id=<?php echo $topic['id']; ?>" target="_blank">[ 单独打开论点 ]</a>
                </div>
            </div>
        </textarea>
        <textarea class="templates" id="new-post-tpl">
            <li class="posts new-post" id="post-<%=data.id %>" data-post-id="<%=data.id %>">
                <div class="data-line clearfix">
                    <div class="operates r">
                        <a href="###" class="op-btn" data-action="share">分享</a>
                    </div>
                    <div class="vote l">
                        <a href="###" class="op-btn btns small agree" data-action="agree" data-intent="1">支持(<b>0</b>)</a>
                        <a href="###" class="op-btn btns small disagree" data-action="agree" data-intent="0">反对(<b>0</b>)</a>
                    </div>
                    <div class="title l">
                        <h2><a href="/topic?post=<%=data.id %>" target="_blank"><%-data.title %></a></h2>
                        <a href="/user" class="uname" target="_blank">作者： <?php echo $account[ 'uname' ]; ?><?php echo $account[ 'desc' ]; ?></a>
                    </div>
                </div>
                <div class="bubbles op-bubbles">
                    <a href="###" class="close"><i class="fa fa-times"></i></a>
                    <div class="triangle"><div class="triangle"></div></div>
                    <div class="inner">
                        <div class="share box clearfix">
                            <div class="qrcode l"></div>
                            <div class="share-part l">
                                <div class="share-btn-boxes share-box">
                                    <span>将自己的论述分享给朋友：</span>
                                    <a class="share-btns" data-dest="qzone"><i class="fa fa-qq"></i></a>
                                    <a class="share-btns" data-dest="weibo"><i class="fa fa-weibo"></i></a>
                                    <a class="share-btns" data-dest="renren"><i class="fa fa-renren"></i></a>
                                    <a class="share-btns" data-dest="tx_weibo"><i class="fa fa-tencent-weibo"></i></a>
                                    <a class="share-btns" data-dest="facebook"><i class="fa fa-facebook-official"></i></a>
                                    <a class="share-btns" data-dest="twitter"><i class="fa fa-twitter"></i></a>
                                </div> 
                                <div class="share-link">
                                    <div class="line clearfix">
                                        <span class="l">分享此条论述：</span>
                                        <a href="http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>&post=<%=data.id %>&fr=sharelink" data-title="<%-data.title %>" target="_blank" class="share-post-link link l">http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>&post=<%=data.id %>&fr=sharelink</a>
                                        <a href="###" class="btns l copy-link">复制链接</a>
                                    </div>
                                    <div class="line clearfix">
                                        <span class="l">分享当前论点：</span>
                                        <a href="http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>&fr=sharelink" data-title="<?php echo $topic['title']; ?>" target="_blank" class="share-topic-link link l">http://www.idizcuz.com/topic?id=<?php echo $topic['id']; ?>&fr=sharelink</a>
                                        <a href="###" class="btns l copy-link">复制链接</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="contents rich-text">
                    <p><%=data.content %></p>
                </div>
                <% if( data.to != 0 ) { %>
                    <div class="to-area">
                        <span><i class="fa fa-hand-o-right"></i> 所针对论述：</span>
                        <a href="/topic?post=<%=data.to.id %>" target="_blank"><%=data.to.title %></a>
                    </div>
                <% } %>
                <div class="bottom-line">
                    <a href="###" class="reply-to r">针对本条论述发表观点</a>
                    <span class="ctime">发表于：<%=data.ctime %></span>
                </div>
            </li>
        </textarea>
        <textarea class="templates" id="comments-list-tpl">
            <% for( var i = 0, l = data.length; i < l; i += 1 ) { %>
                <li id="comment-<%=data[i].id %>" class="comments-item" data-comment-id="<%=data[i].id %>">
                    <a href="/user?u=<%=data[i].account_id %>" class="u-link" target="_blank"><i class="fa fa-user"></i> <%-data[i].account.uname %></a>
                    <p class="comments-text">
                        <% if( data[i].reply_account ) { %>
                            [ 
                            <span>回复 </span>     
                            <a href="/user?u=<%=data[i].reply_account_id %>" target="_blank"%><%-data[i].reply_account.uname %></a>
                            ]
                        <% } %>
                        <%- data[i].content %>
                    </p>
                    <div class="op-line">
                        <span><%=data[i].ctime %></span>
                        <% if( data[i].isSelf ) { %>
                            <a href="###" class="remove-comment" title="删除后论述可以在个人中心找到，可在个人中心恢复发布或彻底删除"><i class="fa fa-trash"></i> 删除</a>
                        <% } else { %>
                            <a href="###" class="reply"><i class="fa fa-reply"></i> 回复</a>
                            <a href="###" class="complaint"><i class="fa fa-flag"></i> 举报</a>
                        <% } %>
                    </div>
                    <form class="comments-form reply-form clearfix">
                        <input type="text" class="comment l" placeholder="输入评论内容" />
                        <a href="###" class="btns submit l" data-comment-id="<%=data[i].id %>" data-account-id="<%=data[i].account_id %>">评论</a>
                    </form>
                </li>
            <% } %>
        </textarea>
        <script src="@Static::common::js/umeditor.config.js"></script>
        <script src="@Static::common::js/umeditor.js"></script>
        <script src="@Static::common::js/qrcode.js"></script>
        <script src="@Static::common::js/qrcode.js"></script>
        <script src="@Static::common::js/ZeroClipboard.js"></script>
        <script>
            var idizcuz = new J();

            var showEditorDialog = function() {
                $( '#editor-float-box' ).append( $( '#editor-area' ) );
                $( '#editor-dialog' ).show();
            };

            var hideEditorDialog = function() {
                $( '#editor-inflow-box' ).append( $( '#editor-area' ) );
                $( '#editor-dialog' ).hide();
            };

            idizcuz.mount( 'events', '@Package::Events', {} );
            idizcuz.mount( 'editor', '@Package::Editor', {} );
            idizcuz.mount( 'posts', '@Package::Posts', {} );
            idizcuz.mount( 'comments', '@Package::Comments', {} );
            idizcuz.mount( 'share', '@Package::Share', {} );
            idizcuz.mount( 'copy', '@Package::Copy', {} );
        </script>
        @Include::common::foot.inc.html
    </body>
</html>
